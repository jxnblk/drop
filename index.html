<!doctype html>
<html>
<head>
  <title>Bassdrop</title>
  <link rel="stylesheet" href="http://d2v52k3cl9vedd.cloudfront.net/basscss.min.css.gz">
  <style>
    .is-target { border-color: #08f }
    .is-dragging { border-color: black; opacity: .5 }
  </style>
</head>
<body>

  <header class="p2">
    <h1>Drop</h1>
  </header>

  <div class="p2 clearfix">
    <div class="py1 px2"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>

    <div class="col col-6 py1"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>
    <div class="col col-6 py1"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>

    <div class="col col-4 py1"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>
    <div class="col col-4 py1"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>
    <div class="col col-4 py1"> <div class="center p4 bg-light-gray border" data-drop> <h2>Box</h2> </div> </div>

  </div>

<script>

  console.log('D R O P');
  var boxes = document.querySelectorAll('[data-drop]');
  var boxesArray = Array.prototype.slice.call(boxes);

  var findDrop = function(node) {
    if (node == document) {
      return null;
    } else if (!node.dataset.drop) {
      return findDrop(node.parentNode);
    } else {
      return node;
    }
  };

  for (var i = 0; i < boxes.length; i++) {

    var box = boxes[i];
    var target;
    var overTarget;
    var enterTarget;
    var isDragging;

    box.setAttribute('draggable', true);
    box.dataset.index = i;
    box.dataset.drop = 1;

    function handleDragStart(e) {
      isDragging = this;
      this.classList.add('is-dragging');
    }
    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      overTarget = e.target;
      return false;
    }
    function handleDragEnter(e) {
      if (this == isDragging) return false;
      this.classList.add('is-target');
      enterTarget = e.target;
    }
    function handleDragLeave(e) {
      if (enterTarget == this && overTarget == this) {
        this.classList.remove('is-target');
      }
    }
    function handleDrop(e) {
      target = findDrop(e.target);
      console.log('D R O P', target.dataset.index);
      this.classList.remove('is-target');
      isDragging.classList.remove('is-dragging');
      isDragging = null;
    }

    box.addEventListener('dragstart', handleDragStart, false);
    box.addEventListener('dragenter', handleDragEnter, false);
    box.addEventListener('dragover', handleDragOver, false);
    box.addEventListener('dragleave', handleDragLeave, false);
    box.addEventListener('drop', handleDrop, false);

  }

</script>

</body>
</html>
